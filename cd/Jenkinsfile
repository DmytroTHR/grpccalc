env.WORKSPACE = pwd()
def version = readFile "${env.WORKSPACE}/version.txt"
def clientPath = "cd/helm/client"
def serverPath = "cd/helm/server"

pipeline{
    agent any

    stages{
        stage('Helm linter'){
            steps{
                sh "helm lint ${clientPath}"
                sh "helm lint ${serverPath}"
            }
        }

        stage('Helm install'){
            steps{
                sh "helm install ${clientPath} --name client --set image.tag=${version}"
                sh "helm install ${serverPath} --name server --set image.tag=${version}"
            }
        }
    }
}